<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>fletchers-cloud-blog/posts/2022/openssh-powershell/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="http://localhost:1313/hugo-theme-console/css/terminal-0.7.4.min.css">
    <link rel="stylesheet" href="http://localhost:1313/hugo-theme-console/css/animate-4.1.1.min.css">
    <link rel="stylesheet" href="http://localhost:1313/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="Using Openssh and creating SSH Keys with Powershell" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/2022/openssh-powershell/" /><meta property="article:published_time" content="2022-04-25T14:27:03+01:00" />



<meta name="twitter:title" content="Using Openssh and creating SSH Keys with Powershell"/>
<meta name="twitter:description" content="In this post I show you my process for creating SSH Keys for Linux Machines.
I use a fair amount of Linux in my work career (creating VMs and the like within Azure). Linux VMs are great for testing with, they use SSH and are configured and ready for testing VERY quickly in Azure. I also use a fair amount of Linux in personal life, with Home assistant and Plex.
I know many people use username and password with Linux environments and there is nothing wrong with this, I simply think that keys are better :smile: . I believe this for a few reasons."/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="http://localhost:1313/" class="no-style site-name">fletchers-cloud-blog</a>:~# 
              <a href='http://localhost:1313/posts'>posts</a>/<a href='http://localhost:1313/posts/2022'>2022</a>/<a href='http://localhost:1313/posts/2022/openssh-powershell'>openssh-powershell</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="http://localhost:1313/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="http://localhost:1313/posts/" typeof="ListItem">posts/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>Using Openssh and creating SSH Keys with Powershell</h1>

Apr. 25, 2022


<br/><br/>
<p>In this post I show you my process for creating SSH Keys for Linux Machines.</p>
<p>I use a fair amount of Linux in my work career (creating VMs and the like within Azure). Linux VMs are great for testing with, they use SSH and are configured and ready for testing VERY quickly in Azure. I also use a fair amount of Linux in personal life, with <a href="https://home-assisant.io">Home assistant</a> and <a href="https://plex.tv">Plex</a>.</p>
<p>I know many people use username and password with Linux environments and there is nothing wrong with this, I simply think that keys are better :smile: . I believe this for a few reasons.</p>
<ol>
<li>Allows for better control over access to a machine - no key, no access.</li>
<li>Allows for a better logon experience, seems more &ldquo;seamless&rdquo;</li>
<li>Key information can be stored in a secure location for repeated use
<ol>
<li>For personal use, I store the key information in <a href="https://1password.com/">1Password</a></li>
<li>For work use, I store the key information in Azure Kayvault</li>
</ol>
</li>
<li>Can be easily scripted to create new keys as needed</li>
</ol>
<p>With the last point, I am a big <a href="https://docs.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.2">PowerShell</a> user and I have created a simple script that work in <a href="https://docs.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell?view=powershell-7.2">PowerShell</a> and <a href="https://github.com/powershell/powershell">PowerShell Core</a>.</p>
<p>You will need openssh for this to work. The command below will help with this üëç.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>choco install openssh
</span></span></code></pre></div><p>Now for the PowerShell code, update the variables as needed. This creates the keys for us.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$username = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>$keyLocation = <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>$keyName = $username
</span></span><span style="display:flex;"><span>$keyPath = $keyLocation + $keyName
</span></span><span style="display:flex;"><span>ssh-keygen -m PEM -t rsa -b <span style="color:#ae81ff">4096</span> <span style="color:#f92672">-f</span> $keyPath -C $username
</span></span></code></pre></div><p>Now to get the content of the public key, for use with Azure VMs or any type of IaC, I use <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=bicep">Bicep</a></p>
<p>You can read the content out to something simple like NotePad (Honestly a tool I use <strong>DAILY</strong>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$pubKeyPath = $keyPath + <span style="color:#e6db74">&#39;.pub&#39;</span>
</span></span><span style="display:flex;"><span>$pubKey = get-content -Path $pubKeyPath
</span></span><span style="display:flex;"><span>$pubKey
</span></span></code></pre></div><p>Example output from $pubkey below, this is what you need to copy and paste within the Azure Portal when creating a Linux VM.</p>
<figure><img src="https://raw.githubusercontent.com/fskelly/cloud.fskelly.com/main/static//images/blogImages/2022/openssh-powershell/ssh-key-example.jpg"
    alt="ssh-key-example">
</figure>

<p>If you want to use this key with an existing, you can. :smile: . We can perform a task similar to ssh-copy-id. Update the <em><strong>$destinationIp</strong></em> as needed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$destinationIp = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>type $pubKeyPath | ssh $username@$destinationIp <span style="color:#e6db74">&#34;cat &gt;&gt; .ssh/authorized_keys&#34;</span>
</span></span></code></pre></div>


        <div class="footer">
    Powered by <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
